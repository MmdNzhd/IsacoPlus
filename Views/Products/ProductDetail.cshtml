@model KaraYadak.ViewModels.ProductDetailSVM

@{
    ViewBag.Title = " ";
    Layout = "_SiteLayout";
    List<KaraYadak.ViewModels.CommentVm> comments = ViewBag.comments;
}
@section vendorstyles{

}
@section styles{
    <style>
        .button-addCart {
            margin-right: 40px;
        }

        .redheart {
            color: #ff0000;
            font-size: 14px;
            font-family: 'arial unicode MS', arial, geneva, sans-serif;
        }
    </style>
}
@section vendors{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
            integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
            crossorigin="anonymous"></script>




    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha256-OFRAJNoaD8L3Br5lglV7VyLRf0itmoBzWUoM+Sji4/8=" crossorigin="anonymous"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/js/fontawesome.min.js"
            integrity="sha256-fjQmECvnpgwxO4TyEkO7CJeu97Lu+JKoGDCNEVDs7X0=" crossorigin="anonymous"></script>
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript"
            src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.0/js/mdb.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"
            integrity="sha256-pTxD+DSzIwmwhOqTFN+DB+nHjO4iAsbgfyFq5K5bcE0=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/5.4.5/js/swiper.min.js"
            integrity="sha256-NiMdnMv0WBAps3M8mcB7WHzlanETt0rnwMCgg67DgCk=" crossorigin="anonymous"></script>




}
@section scripts{
    <script src="~/assets/js/jquery.cookie.js"></script>
    <script>

        //IsFav
        function IsFav() {
            let code = $("#like").attr("data-id");
            $.ajax({
                type: "Post",
                url: "/Products/IsFavoriteForThisUser ",
                data: { "code": code },
                success: function (data) {

                    if (data.status == "0") {
                        toastr.error(data.message);
                    }
                    else {
                        var isFav = data.result;
                        if (isFav) {
                            $("#like").removeClass("fa-heart-o").addClass("fa-heart")
                        }
                        else {
                            $("#like").removeClass("fa-heart").addClass("fa-heart-o")

                        }
                    }


                },
                error: function (data) {
                    console.log(data);
                }
            })
        }
        $(document).ready(function () {
            IsFav();
        });

        //addToFavorite
        function addToFav(e) {
            let code = $(e).attr("data-id");
            $.ajax({
                type: "Post",
                url: "/Products/AddToFavorite ",
                data: { "code": code },
                success: function (data) {
                    if (data.status == "0") {
                        toastr.error(data.message);
                    } if (data.status == "2") {
                        toastr.warning(data.message);
                        $("#centralModalLogin").modal("toggle");
                    }
                    if (data.status == "1") {
                        toastr.warning(data.message);
                        IsFav();
                    }


                },
                error: function (data) {
                    toastr.warning("خطایی رخ داده است");
                    console.log(data);
                }
            });
        }

        function likeOrDislike(item) {
            if ($(item).children('i').hasClass('fa-heart-o')) {
                $(item).children('i').animate().addClass('fa-heart');
                $(item).children('i').attr('transform', 'scale(1.3)');
                $(item).children('i').animate().removeClass('fa-heart-o');
            } else {
                $(item).children('i').animate().addClass('fa-heart-o');
                $(item).children('i').attr('transform', 'scale(1.3)');
                $(item).children('i').animate().removeClass('fa-heart');
            }
        }

        $(".cta").mouseenter(function () {
            $(this).addClass("active").delay(300).queue(function (next) {
                $(this).removeClass("active");
                next();
            });

        });
        // ------swiper-----
        var galleryThumbs = new Swiper('.gallery-thumbs', {
            spaceBetween: 10,
            slidesPerView: 4,
            freeMode: true,
            watchSlidesVisibility: true,
            watchSlidesProgress: true,
        });
        var galleryTop = new Swiper('.gallery-top', {
            spaceBetween: 10,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            thumbs: {
                swiper: galleryThumbs
            }
        });

        $("#commentSubmit").submit(function (e) {
            e.preventDefault();
            let code = $("#like").attr("data-id");
            let text = $("#text").val();
            if (text.length < 1) {
                toastr.error("لطفا نظر خود را وارد کنید")
                return;
            }

            $.ajax({
                type: "Post",
                url: "/Products/AddCommentInProduct ",
                data: { "code": code, "text": text },
                success: function (data) {
                    if (data.status == "0") {
                        toastr.error(data.message);
                    } if (data.status == "2") {
                        toastr.warning(data.message);
                    }
                    if (data.status == "1") {
                        toastr.info(data.message);
                    }


                },
                error: function (data) {
                    toastr.warning("خطایی رخ داده است");
                    console.log(data);
                }
            });
        })

        $("#addToShopBascket").on("click", function (e) {
            var products = [];
            e.preventDefault();

            var oldCookieValue = $.cookie('cart');
            var pId = $(this).attr("data-item-id");
            products[0] = pId;
            if (oldCookieValue == undefined) {
                $.cookie('cart', products, { expires: 7, path: '/' });

            } else {

                var value = oldCookieValue + "," + new String(products);
                value = removeDuolicate(value);
                $.removeCookie('cart', { path: '/' });
                //Create new cookie with same name and concatenate the old and new desired value.
                $.cookie('cart', value, { expires: 7, path: '/' });
            }
            products = [];
            var cooki = $.cookie('cart');
            var productCount = cooki.split(",").length;
            $('#cartCount').text(productCount);

        });

        function removeDuolicate(a) {
            var cookieVal = a.split(",");
            var realValue = [];
            for (i = 0; i < cookieVal.length; i++) {
                if (jQuery.inArray(cookieVal[i], realValue) !== -1) {
                    continue;
                }
                else {
                    realValue.push(cookieVal[i]);
                }
            }
            return realValue;
        }
    </script>

}
@*header*@
<div class="container-fluid p-0 mx-auto  bg-product">

    <partial name="Header" />

    @*ProductDetail*@
    @if (Model == null)
    {
        <div class="row w-100 mx-auto all-pruDetalis py-5">
            محصولی یافت نشد
        </div>

    }
    else
    {

        <div class="row w-100 mx-auto all-pruDetalis py-5">
            <div class="col-md-6 mx-auto text-md-right text-center">
                <img src="@Model.Product.Images" class="img-fluid mx-auto width-60 mb-5 pb-5">
            </div>
            <div class="col-md-6">
                <div class="row w-100 mx-auto">
                    <div class="col-6 text-right">
                        <h3><b>@Model.Product.Title</b></h3>
                    </div>
                    <div class="col-6 text-left">
                        <h4 class="cost"><b> @Model.Product.Price تومان</b></h4>
                    </div>
                </div>
                <div class="row w-100 mx-auto">
                    <div class="col-12">
                        <h6 class="text-justify detalis-takproduct">
                            @Model.Product.Description
                        </h6>
                    </div>
                </div>
                <div class="row w-100 mx-auto pb-5 pt-4">
                    <div data-id="@Model.Product.Code" onclick="addToFav(this)"><i id="like" data-id="@Model.Product.Code" class="fa fa-heart-o col-2 " style="font-size:45px"></i></div>
                    <button type="button" data-item-id="@Model.Product.Code" id="addToShopBascket" class="ml-3 col-8 btn btn-warning w-100 button-addCart">افزودن به سبد خرید</button>
                </div>
            </div>
        </div>


    }
</div>

<!-- ----Suitable for car--- -->
<div class="row w-100 mx-auto text-center py-4 mt-5 pt-5">
    <div class="col-lg-4 col-3 text-left pt-4">
        <img src="~/img/Line 35.png" class="img-fluid w-25 mx-auto border-titr">
    </div>
    <div class="col-lg-4 col-6">
        <h2><b class="font-kalameBlack"> مناسب برای خودرو های زیر</b></h2>
    </div>
    <div class="col-lg-4 col-3 text-right pt-4">
        <img src="~/img/Line 35.png"
             class="img-fluid w-25 mx-auto border-titr">
    </div>
</div>
<!-- --model car-- -->
<div class="container modelCar">
    <div class="row w-100 mx-auto text-center py-3">
        @*<div class="col-4">
                <img src="~/img/21.png" class="img-fluid w-25">
            </div>
            <div class="col-4">
                <img src="~/img/Kia-1.png" class="img-fluid w-25">
            </div>
            <div class="col-4">
                <img src="~/img/Iran-Khodro-2.png" class="img-fluid w-25">
            </div>*@
        @foreach (var item in Model.CarCategoriesForProduct)
        {
            <div class="col-4">
                <img src=@item.Key class="img-fluid w-25">
            </div>
        }
    </div>
    @foreach (var item in Model.CarCategoriesForProduct)
    {
        <div class="row w-100 mx-auto text-center py-3">

            @foreach (var val in item.Value)
            {
                <div class="col-4">
                    <h5> <b>@val</b></h5>
                </div>
            }
        </div>
    }
</div>
<!-- --model car-- -->
<!--Comments-->
@if (comments.Count > 0)
{

    <div class="row w-100 mx-auto text-center py-4 mt-5 pt-5">
        <div class="col-lg-4 col-3 text-left pt-4">
            <img src="~/img/Line 35.png" class="img-fluid w-25 mx-auto border-titr">
        </div>
        <div class="col-lg-4 col-6">
            <h2><b class="font-kalameBlack"> نظر کاربران </b></h2>
        </div>
        <div class="col-lg-4 col-3 text-right pt-4">
            <img src="~/img/Line 35.png"
                 class="img-fluid w-25 mx-auto border-titr">
        </div>
    </div>


    <div class="row w-100 mx-auto text-center py-5 mb-5">
        <!-- --- -->
        <!-- Swiper -->
        <div class="swiper-container swiper-containerBlog swiper-container-initialized swiper-container-horizontal swiper-container-rtl">
            <div class="swiper-wrapper" style="transform: translate3d(0px, 0px, 0px);">
                @foreach (var item in comments)
                {
                    <div class="swiper-slide" style="width: 476.667px; margin-left: 30px;">
                        <div class=" hj-blog p-0">
                            <div class="row w-100 mx-auto  bgComment">
                                <div class="col-6 text-right ">
                                    <h6 class="py-2 pr-4 pt-3"><b> نظر کاربران </b></h6>
                                </div>
                                <div class="col-6 text-left pt-2">
                                    <div class="star-rating">
                                        <input id="star-5" type="radio" name="rating" value="star-5" />
                                        <label for="star-5" title="5 stars">
                                            <i class="active fa fa-star" aria-hidden="true"></i>
                                        </label>
                                        <input id="star-4" type="radio" name="rating" value="star-4" />
                                        <label for="star-4" title="4 stars">
                                            <i class="active fa fa-star" aria-hidden="true"></i>
                                        </label>
                                        <input id="star-3" type="radio" name="rating" value="star-3" />
                                        <label for="star-3" title="3 stars">
                                            <i class="active fa fa-star" aria-hidden="true"></i>
                                        </label>
                                        <input id="star-2" type="radio" name="rating" value="star-2" />
                                        <label for="star-2" title="2 stars">
                                            <i class="active fa fa-star" aria-hidden="true"></i>
                                        </label>
                                        <input id="star-1" type="radio" name="rating" value="star-1" />
                                        <label for="star-1" title="1 star">
                                            <i class="active fa fa-star" aria-hidden="true"></i>
                                        </label>
                                    </div>
                                </div>

                            </div>
                            <div class="row w-100 mx-auto py-2">
                                <div class="col-12 detalis-blog px-4 py-3">
                                    <h6 class="text-right"><b>@item.UserFullName</b></h6><br>
                                    <h6 class="text-justify">
                                        @item.Text
                                    </h6>
                                </div>

                            </div>
                        </div>
                    </div>

                }
            </div>
            <!-- Add Pagination -->
            <div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets">
                <span class="swiper-pagination-bullet swiper-pagination-bullet-active" tabindex="0" role="button"
                      aria-label="Go to slide 1"></span><span class="swiper-pagination-bullet" tabindex="0" role="button"
                                                              aria-label="Go to slide 2"></span><span class="swiper-pagination-bullet" tabindex="0" role="button"
                                                                                                      aria-label="Go to slide 3"></span>
            </div>

            <span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span><span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>
        </div>
        <!-- ---- -->


    </div>
}
<!--Comments-->
<form id="commentSubmit">
    <div class="row">
        <textarea id="text" class="form-control col-10 m-auto"></textarea>
    </div>
    <div class="row">
        <button class="btn btn-success col-2 m-auto mt-1">ثبت نظر</button>
    </div>
</form>

<!--product-->
<div class="row w-100 mx-auto text-center py-4 pt-2">
    <div class="col-lg-5 col-3 text-left pt-4">
        <img src="~/img/Line 35.png" class="img-fluid w-25 mx-auto border-titr">
    </div>
    <div class="col-lg-2 col-6">
        <h2><b class="font-kalameBlack"> محصولات دیگر</b></h2>
    </div>
    <div class="col-lg-5 col-3 text-right pt-4"> <img src="~/img/Line 35.png" class="img-fluid w-25 mx-auto border-titr"></div>
</div>

@Html.Partial("OtherProducts", Model.OtherProduct)
